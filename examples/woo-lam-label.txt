---\n\n## Woo and Lam Mutual Authentication Protocol\n\n### Overview\n\nThe Woo and Lam mutual authentication protocol is designed to facilitate secure authentication between two parties (the initiator `I` and the responder `R`) with the involvement of a trusted server `S`. The protocol ensures that both parties can authenticate each other while protecting their identities and ensuring the freshness of the exchanged messages.\n\n### Participants\n\n1. **Initiator (I)**: The party that starts the authentication process.\n2. **Responder (R)**: The party that responds to the initiator's authentication request.\n3. **Server (S)**: A trusted third-party server that helps facilitate the secure exchange of session keys.\n\n### Key Concepts\n\n- **Nonce**: A random number used only once in a session to prevent replay attacks.\n- **Session Key (Kir)**: A key established for secure communication between `I` and `R`.\n- **Ticket**: A piece of information used for authentication, typically containing encrypted data to prove identity.\n\n### Protocol Steps\n\n1. **Step 1 (Initiation)**: The initiator (`I`) generates a nonce (`N1`) and sends it to the responder (`R`) along with its identity.\n   \n   ```\n   send_1(I, R, I, N1);\n   ```\n\n2. **Step 2 (Response)**: The responder (`R`) generates its own nonce (`N2`) and sends it back to `I`, along with its identity.\n   \n   ```\n   recv_2(R, I, R, N2);\n   ```\n\n3. **Step 3 (Session Key Request)**: The initiator sends a message containing its identity, the responder\u2019s identity, and both nonces, encrypted with a session key (`k(I, S)`) to the server.\n   \n   ```\n   send_3(I, R, {I, R, N1, N2}k(I, S));\n   ```\n\n4. **Step 4 (Ticket Generation)**: The server generates a session key (`Kir`) and sends a message to `R`, which includes the responder's identity, both nonces, and the session key, encrypted with `k(R, S)`.\n   \n   ```\n   recv_6(R, I, {R, N1, N2, Kir}k(I, S), {N1, N2}Kir);\n   ```\n\n5. **Step 5 (Final Response)**: The responder (`R`) sends the nonce `N2` back to `I`, encrypted with the session key (`Kir`).\n   \n   ```\n   send_7(I, R, {N2}Kir);\n   ```\n\n### Claims\n\n- **Claim I1**: The initiator (`I`) claims that it has established a secret session key (`Kir`).\n- **Claim I2**: The initiator (`I`) claims that there is no synchronization issue.\n- **Claim I3**: The initiator (`I`) claims that the session key is fresh and has not been compromised.\n\n- **Claim R1**: The responder (`R`) claims that it has established a secret session key (`Kir`).\n- **Claim R2**: The responder (`R`) claims that there is no synchronization issue.\n- **Claim R3**: The responder (`R`) claims that the session key is fresh and has not been compromised.\n\n### Conclusion\n\nThe Woo and Lam mutual authentication protocol effectively provides a mechanism for two parties to authenticate each other and establish a secure session key through a trusted server, while ensuring the freshness of the session keys and preventing replay attacks.\n\n---


# Woo and Lam Mutual Authentication\n#\n# Modelled after the description in the SPORE library\n# http://www.lsv.ens-cachan.fr/spore/wooLamMutual.html\n#\n\n\nusertype SessionKey;\n\nconst Fresh: Function;\nconst Compromised: Function;\n\nprotocol woolam(I,R,S)\n{\n    role I\n    {\n        fresh N1: Nonce;\n        var Kir: SessionKey;\n        var N2: Nonce;\n\n        send_1(I,R, I, N1); \n        recv_2(R,I, R, N2);\n        send_3(I,R, {I, R, N1, N2}k(I,S));\n        recv_6(R,I, {R, N1, N2, Kir}k(I,S), {N1,N2}Kir);\n        send_7(I,R, {N2}Kir);\n        \n\n        claim_I1(I,Secret,Kir);\n        claim_I2(I,Nisynch);\n        claim_I3(I,Empty,(Fresh,Kir));\n    }    \n    \n    role R\n    {\n        fresh N2: Nonce;\n        var N1: Nonce;\n        var Kir: SessionKey;\n        var T1,T2: Ticket;\n\n        recv_1(I,R, I, N1);\n        send_2(R,I, R, N2);\n        recv_3(I,R, T1);\n        send_4(R,S, T1, {I, R, N1, N2}k(R,S));\n        recv_5(S,R, T2, {I, N1, N2, Kir}k(R,S));\n        send_6(R,I, T2, {N1,N2}Kir);\n        recv_7(I,R, {N2}Kir);\n        \n        claim_R1(R,Secret,Kir);\n        claim_R2(R,Nisynch);\n        claim_R3(R,Empty,(Fresh,Kir));\n    }\n\n    role S\n    {\n        fresh Kir: SessionKey;\n        var N1,N2: Nonce;\n\n        recv_4(R,S, {I, R, N1, N2}k(I,S), {I, R, N1, N2}k(R,S));\n        send_5(S,R, {R, N1, N2, Kir}k(I,S), {I, N1, N2, Kir}k(R,S));\n    }\n}
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CrypFormBench — Formal Evaluation of Cryptographic Schemes</title>
<meta name="description" content="CrypFormBench (C.F.B): Benchmarking LLMs for formal analysis of cryptographic schemes and protocols." />
<style>
:root{
  --bg:#0b1220; --panel:#0f172a99; --glass:#ffffff10; --text:#e6ebff; --muted:#94a3b8;
  --primary:#60a5fa; --accent:#22d3ee; --shadow:0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(135deg,#0b1220,#0a0f1c 40%,#0e1a2b);color:var(--text)}
.bg-orb{position:fixed;z-index:-1;filter:blur(80px);opacity:.6;pointer-events:none}
.orb1{top:-120px;left:-100px;width:420px;height:420px;background:radial-gradient(circle at 30% 30%,#1f9aff,transparent 60%)}
.orb2{bottom:-120px;right:-120px;width:520px;height:520px;background:radial-gradient(circle at 70% 70%,#22d3ee,transparent 60%)}
.nav{position:sticky;top:0;display:flex;justify-content:space-between;align-items:center;padding:14px 24px;background:rgba(8,13,23,.35);backdrop-filter:blur(12px);border-bottom:1px solid #ffffff0f}
.nav .brand{display:flex;gap:10px;align-items:center}
.logo{width:34px;height:34px;border-radius:8px;background:linear-gradient(135deg,#60a5fa,#22d3ee);display:grid;place-items:center;font-weight:800;color:#0b1220;box-shadow:var(--shadow)}
.brand-text{font-weight:700;letter-spacing:.4px}
.nav a{color:var(--text);text-decoration:none;margin:0 10px;font-weight:500;opacity:.85}
.nav a:hover{opacity:1}
.btn{display:inline-block;padding:10px 16px;border-radius:10px;background:#ffffff14;color:var(--text);text-decoration:none;border:1px solid #ffffff22;transition:.2s ease;backdrop-filter:blur(8px)}
.btn:hover{transform:translateY(-1px);border-color:#ffffff44}
.btn.primary{background:linear-gradient(135deg,#3b82f6,#22d3ee);color:#04121e;border:0;font-weight:700}
.btn.ghost{background:transparent;border:1px solid #ffffff30}
.hero{padding:80px 24px 20px;max-width:1100px;margin:0 auto;text-align:center}
.hero h1{font-size:48px;line-height:1.12;margin:0 0 12px;font-weight:800}
.grad{background:linear-gradient(135deg,#60a5fa,#22d3ee);-webkit-background-clip:text;background-clip:text;color:transparent}
.subtitle{color:var(--muted);font-size:18px}
.hero-actions{margin:22px auto 26px;display:flex;gap:14px;justify-content:center}
.hero-kpis{display:grid;grid-template-columns:repeat(4,minmax(120px,1fr));gap:12px;margin:10px auto 0;max-width:800px}
.kpi{background:var(--panel);border:1px solid #ffffff18;padding:14px;border-radius:12px;box-shadow:var(--shadow)}
.kpi span{display:block;font-size:26px;font-weight:800}
.kpi label{color:var(--muted);font-size:12px;letter-spacing:.3px}
.section-head{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:16px}
.select{display:flex;gap:8px;align-items:center;color:var(--muted)}
.select select{background:#0e1527;border:1px solid #1e293b;color:var(--text);padding:8px 10px;border-radius:8px}
.why{padding:48px 24px;max-width:1100px;margin:0 auto}
.why h2{margin:0 0 14px}
.cards{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.card{padding:16px;border-radius:12px;border:1px solid #ffffff14;background:var(--panel);box-shadow:var(--shadow)}
.card.glass{background:linear-gradient(180deg,#ffffff12,#ffffff08)}
.leaderboard{padding:28px 24px;max-width:1100px;margin:0 auto}
.lb-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.lb-card{padding:16px;border-radius:14px;border:1px solid #ffffff18;background:linear-gradient(180deg,#0e192c,#0c1423);box-shadow:var(--shadow);position:relative;overflow:hidden}
.badge{position:absolute;right:12px;top:12px;font-size:12px;background:#ffffff14;padding:6px 8px;border-radius:8px;border:1px solid #ffffff22}
.lb-name{font-weight:700;margin-bottom:8px}
.lb-score{font-size:28px;font-weight:800}
.meter{height:8px;background:#0b1220;border-radius:999px;border:1px solid #1f2a3d;overflow:hidden;margin-top:10px}
.meter>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#22d3ee,#60a5fa)}
.lb-caps{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.cap-chip{font-size:12px;padding:6px 8px;border-radius:999px;border:1px solid #ffffff1f;background:#ffffff0f}
.capabilities{padding:28px 24px;max-width:1100px;margin:0 auto}
.cap-wrap{display:grid;grid-template-columns:420px 1fr;gap:16px;align-items:center}
.radar-wrap{position:relative;border:1px solid #ffffff18;border-radius:16px;padding:10px;background:#0c1423}
.radar-legend{position:absolute;right:10px;top:10px;font-size:12px;color:var(--muted)}
.model-list{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.model-item{padding:12px;border-radius:10px;background:#0e182a;border:1px solid #ffffff18;cursor:pointer;transition:.15s}
.model-item:hover{transform:translateY(-2px)}
.model-item.active{outline:2px solid #22d3ee}
.dataset{padding:28px 24px;max-width:1100px;margin:0 auto}
.dataset .tagline{color:var(--muted);margin-bottom:12px}
.tags{display:flex;gap:8px;flex-wrap:wrap}
.tags span{padding:6px 10px;border-radius:999px;background:#0e182a;border:1px solid #ffffff18}
.pipeline{padding:28px 24px;max-width:900px;margin:0 auto;text-align:center}
.flow{list-style:none;display:flex;gap:10px;justify-content:center;padding:0;margin:10px 0 8px}
.flow li{position:relative;background:#0e182a;border:1px solid #ffffff18;color:var(--text);padding:12px 14px;border-radius:12px}
.flow li span{display:inline-grid;place-items:center;width:22px;height:22px;border-radius:6px;background:linear-gradient(135deg,#22d3ee,#60a5fa);color:#04121e;font-weight:800;margin-right:8px}
.cta{padding:40px 24px;max-width:880px;margin:0 auto;text-align:center}
.cta .cta-actions{margin-top:10px;display:flex;gap:12px;justify-content:center}
.footer{padding:26px 24px;color:var(--muted);text-align:center;border-top:1px solid #ffffff0f;background:#0a111e}
@media (max-width:980px){.cards{grid-template-columns:1fr 1fr}.lb-grid{grid-template-columns:1fr 1fr}.cap-wrap{grid-template-columns:1fr}.model-list{grid-template-columns:1fr 1fr}.hero h1{font-size:38px}}
@media (max-width:640px){.cards{grid-template-columns:1fr}.lb-grid{grid-template-columns:1fr}.model-list{grid-template-columns:1fr}}
.dark body{background:linear-gradient(135deg,#070b13,#04060b)}
</style>
</head>
<body>
  <div class="bg-orb orb1"></div>
  <div class="bg-orb orb2"></div>

  <header class="nav">
    <div class="brand">
      <div class="logo">CFB</div>
      <div class="brand-text">CrypFormBench</div>
    </div>
    <nav>
      <a href="#why">Why C.F.B</a>
      <a href="#leaderboard">Leaderboard</a>
      <a href="#capabilities">Capabilities</a>
      <a href="#dataset">Coverage</a>
      <a href="#pipeline">Pipeline</a>
      <a href="#eval-process">Real-Cases</a>
      <a href="#demo-video">Vedio</a>
      <a class="btn ghost" href="#get-started">Get Started</a>
    </nav>
  </header>

  <section class="hero">
    <h1>Formal Evaluation of <span class="grad">Cryptographic Schemes</span><br/>— Let the data speak.</h1>
    <p class="subtitle">Coverage × Correctness × Reproducibility — from high-level intent to implementation artifacts, across five model capabilities.</p>
    <div class="hero-actions">
      <a class="btn primary" href="#leaderboard">See latest results</a>
      <a class="btn" href="#why">Why choose C.F.B</a>
    </div>
    <div class="hero-kpis">
      <div class="kpi"><span id="kpi-models">9</span><label>Models</label></div>
      <div class="kpi"><span id="kpi-lang">7</span><label>Formal languages</label></div>
      <div class="kpi"><span id="kpi-tasks">5</span><label>Capabilities</label></div>
      <div class="kpi"><span id="kpi-repro">100%</span><label>Reproducible</label></div>
    </div>
  </section>

  <section id="why" class="why">
    <h2>Why C.F.B</h2>
    <div class="cards">
      <div class="card glass">
        <h3>Multi-backend validation</h3>
        <p>ProVerif, Tamarin, Scyther, Maude-NPA, AVISPA, CryptoVerif, EasyCrypt — cross-tool verification for robust conclusions.</p>
      </div>
      <div class="card glass">
        <h3>Design → Implementation</h3>
        <p>From protocol goals/assumptions to implementation-level artifacts (e.g., Jasmin/constant-time checks), end-to-end coverage.</p>
      </div>
      <div class="card glass">
        <h3>Five capabilities</h3>
        <p>Interpretation / Generation/ Completion / Transformation / Correction — not just “write”, but “verify”.</p>
      </div>
      <div class="card glass">
        <h3>Comprehensive dataset</h3>
        <p>Curated end-to-end from design intent to implementation, covering protocols/schemes, security properties (secrecy, auth, integrity, freshness, PFS, IND-CPA/CCA, equivalence), adversary models (Dolev–Yao, state/ephemeral leaks, CK/eCK).</p>
      </div>
    </div>
  </section>

  <section id="leaderboard" class="leaderboard">
    <div class="section-head">
      <h2>Overall Leaderboard (recomputed)</h2>
      <div class="controls">
        <label class="select">
          <span>Sort by</span>
          <select id="sortKey">
            <option value="overall">Overall</option>
            <option value="interpret">Interpretation</option>
            <option value="generate">Generation</option>
            <option value="complete">Completion</option>
            <option value="fix">Correction</option>
            <option value="convert">Transformation</option>
          </select>
        </label>
        <button id="toggleDark" class="btn ghost">Dark</button>
      </div>
    </div>
    <div id="lb-grid" class="lb-grid"></div>
  </section>

  <section id="capabilities" class="capabilities">
    <h2>Capability Radar</h2>
    <div class="cap-wrap">
      <div class="radar-wrap">
        <canvas id="radar" width="420" height="420" aria-label="Model capability radar"></canvas>
        <div id="radar-legend" class="radar-legend"></div>
      </div>
      <div class="model-list" id="modelList"></div>
    </div>
  </section>

  <section id="dataset" class="dataset">
    <h2>Coverage</h2>
    <div class="tagline">Schemes/Protocols × Security properties × Adversary models × Formal languages</div>
    <div class="tags">
      <span>Secrecy</span><span>Authentication</span><span>Integrity</span><span>Freshness</span>
      <span>Forward Secrecy</span><span>IND-CPA/CCA</span><span>Equivalence</span><span>Dolev–Yao</span>
      <span>CK/eCK</span><span>ProVerif</span><span>Tamarin</span><span>Scyther</span><span>AVISPA</span><span>Maude-NPA</span><span>CryptoVerif</span><span>EasyCrypt</span>
    </div>
  </section>

  <section id="pipeline" class="pipeline">
    <h2>Evaluation Pipeline</h2>
    <ol class="flow">
      <li><span>1</span> Generate</li>
      <li><span>2</span> Verify</li>
      <li><span>3</span> Aggregate</li>
      <li><span>4</span> Viz</li>
      <li><span>5</span> Render</li>
    </ol>
    <p class="note">Fully scriptable & CI-friendly; scoring formulas and weights are configurable.</p>
  </section>

  <section id="get-started" class="cta">
    <h2>Get Started</h2>
    <p>Use <code>scripts/cfb.sh</code> to reproduce results and figures locally in one go.</p>
    <div class="cta-actions">
      <a class="btn primary" href="#leaderboard">Explore Results</a>
      <a class="btn ghost" href="https://github.com/Eval4LLMs/CrypFormBench">See Pipeline</a>
    </div>
  </section>

<script>
window.__CFB__ = {
  models: [
    {"name":"Claude-3.5-Sonnet-Coder","generate":24.2,"complete":74.4,"fix":71.2,"convert":22.7,"interpret":91.7,"overall":51.0},
    {"name":"DeepSeek-Coder","generate":5.8,"complete":68.0,"fix":63.9,"convert":0.0,"interpret":93.2,"overall":38.6},
    {"name":"GPT-4o","generate":9.5,"complete":51.5,"fix":54.7,"convert":0.0,"interpret":94.1,"overall":35.0},
    {"name":"DeepSeek-R1","generate":5.8,"complete":65.2,"fix":56.9,"convert":0.0,"interpret":77.4,"overall":34.6},
    {"name":"LLaMA4-Instruct","generate":5.8,"complete":55.6,"fix":57.2,"convert":0.0,"interpret":44.4,"overall":27.8},
    {"name":"GPT-4o-mini","generate":0.0,"complete":10.9,"fix":44.8,"convert":0.0,"interpret":93.8,"overall":23.0},
    {"name":"Gemini-2.5-Pro","generate":7.7,"complete":25.9,"fix":35.6,"convert":0.0,"interpret":69.1,"overall":22.8},
    {"name":"Grok-3","generate":12.8,"complete":36.7,"fix":0.0,"convert":0.0,"interpret":49.6,"overall":18.0},
    {"name":"GLM-4","generate":0.0,"complete":22.8,"fix":14.5,"convert":0.0,"interpret":62.3,"overall":16.1}
  ]
};

(() => {
  const state = { models: window.__CFB__.models || [], sortKey:'overall', activeIndex:0 };
  const $ = q => document.querySelector(q); const $$ = q => Array.from(document.querySelectorAll(q));

  function renderLeaderboard(){
    const grid = $('#lb-grid');
    const data = [...state.models].sort((a,b)=> b[state.sortKey]-a[state.sortKey]);
    grid.innerHTML = data.map((m,i)=>{
      const caps = ['interpret','generate','complete','fix','convert']
        .map(k=>`<span class="cap-chip">${k[0].toUpperCase()+k.slice(1)} ${m[k].toFixed(1)}</span>`).join('');
      const width = Math.max(0, Math.min(100, m.overall));
      return `<div class="lb-card">
        <div class="badge">#${i+1}</div>
        <div class="lb-name">${m.name}</div>
        <div class="lb-score">${m.overall.toFixed(1)}</div>
        <div class="meter"><i style="width:${width}%"></i></div>
        <div class="lb-caps">${caps}</div>
      </div>`;
    }).join('');
  }

  function drawRadar(){
    const cvs=$('#radar'), ctx=cvs.getContext('2d'), W=cvs.width, H=cvs.height;
    ctx.clearRect(0,0,W,H);
    const center={x:W/2,y:H/2}, R=Math.min(W,H)/2-32, axes=['interpret','generate','complete','fix','convert'];
    ctx.strokeStyle='rgba(255,255,255,.12)';
    for(let r=0;r<=5;r++){ ctx.beginPath(); const rr=(R/5)*r;
      for(let i=0;i<axes.length;i++){ const ang=-Math.PI/2+i*(2*Math.PI/axes.length);
        const x=center.x+rr*Math.cos(ang), y=center.y+rr*Math.sin(ang);
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      } ctx.closePath(); ctx.stroke();
    }
    for(let i=0;i<axes.length;i++){ const ang=-Math.PI/2+i*(2*Math.PI/axes.length);
      const x=center.x+R*Math.cos(ang), y=center.y+R*Math.sin(ang);
      ctx.beginPath(); ctx.moveTo(center.x,center.y); ctx.lineTo(x,y); ctx.stroke();
      ctx.fillStyle='rgba(230,235,255,.85)'; ctx.font='12px Inter, system-ui';
      const label=axes[i][0].toUpperCase()+axes[i].slice(1);
      ctx.fillText(label, x+(x<center.x?-40:10), y+(y<center.y?-8:14));
    }
    const m=state.models[state.activeIndex]||state.models[0];
    const vals=axes.map(k=>Math.max(0,Math.min(100,m[k])));
    ctx.beginPath();
    for(let i=0;i<axes.length;i++){ const ang=-Math.PI/2+i*(2*Math.PI/axes.length);
      const rr=(vals[i]/100)*R; const x=center.x+rr*Math.cos(ang), y=center.y+rr*Math.sin(ang);
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    } ctx.closePath();
    const grad=ctx.createLinearGradient(0,0,W,H);
    grad.addColorStop(0,'rgba(34,211,238,.55)'); grad.addColorStop(1,'rgba(96,165,250,.55)');
    ctx.fillStyle=grad; ctx.fill(); ctx.strokeStyle='rgba(34,211,238,.85)'; ctx.lineWidth=2; ctx.stroke();
    $('#radar-legend').textContent = m?.name || '';
  }

  function renderModelList(){
    const list = $('#modelList');
    list.innerHTML = state.models.map((m,i)=>`
      <div class="model-item ${i===state.activeIndex?'active':''}" data-idx="${i}">
        <div style="font-weight:700">${m.name}</div>
        <div style="color:#94a3b8;font-size:12px">Overall ${m.overall.toFixed(1)}</div>
      </div>
    `).join('');
    $$('#modelList .model-item').forEach(el => el.addEventListener('click', () => {
      state.activeIndex = +el.dataset.idx; renderModelList(); drawRadar();
    }));
  }

  function initControls(){
    $('#sortKey').addEventListener('change', e => { state.sortKey=e.target.value; renderLeaderboard(); });
    $('#toggleDark').addEventListener('click', ()=> document.documentElement.classList.toggle('dark'));
  }

  renderLeaderboard(); renderModelList(); drawRadar(); initControls();
})();
</script>

<!-- ========== Eval Process Viewer (drop-in section) ========== -->
<section id="eval-process" class="epv">
  <div class="epv__head">
    <h2>Visualization of the Evaluation Process (Real-world Cases)</h2>
    <div class="epv__controls">
      <label>Task
        <select id="epv-task">
          <option value="generation">generation</option>
          <option value="completion">completion</option>
          <option value="translation">translation</option>
          <option value="interpretation_logic">interpretation_logic</option>
          <option value="interpretation_notation">interpretation_notation</option>
          <option value="correction_false">correction_false</option>
          <option value="correction_error">correction_error</option>
        </select>
      </label>
      <label>Language
        <select id="epv-lang"></select>
      </label>
      <label>Model
        <select id="epv-model"></select>
      </label>
      <button id="epv-reload" class="epv__btn" title="Reload from JSON">↻</button>
    </div>
    <div id="epv-toast" class="epv__toast" aria-live="polite"></div>
  </div>

  <div class="epv__pipeline">
    <article class="epv__card">
      <header>① Dataset Content <small>(inputdata)</small></header>
      <div class="epv__kv">
        <div><b style="margin-right: 10px;">file</b><span id="epv-file">—</span></div>
      </div>
      <pre class="epv__code"><code id="epv-inputdata">—</code></pre>
    </article>

    <article class="epv__card">
      <header>② Prompt <small>(prompt)</small></header>
      <pre class="epv__code"><code id="epv-prompt">—</code></pre>
    </article>

    <article class="epv__card">
      <header>③ Model Input <small>(modelinput)</small></header>
      <pre class="epv__code"><code id="epv-modelinput">—</code></pre>
    </article>

    <article class="epv__card">
      <header>④ Model Output <small>(modeloutput)</small></header>
      <pre class="epv__code"><code id="epv-modeloutput">—</code></pre>
    </article>

    <article class="epv__card">
      <header>⑤ Eval Result <small>(evalresult)</small></header>
      <pre class="epv__code"><code id="epv-evalresult">—</code></pre>
    </article>
  </div>
</section>

<style>
  .epv{--epv-accent:#22d3ee;--epv-fg:var(--fg,#e5e7eb);--epv-bg:var(--bg,#0b1220);--epv-muted:#94a3b8}
  .epv{margin:2rem 0;padding:1rem;border-radius:12px;background:linear-gradient(180deg,rgba(34,211,238,.08),transparent);}
  .epv__head{display:flex;flex-wrap:wrap;align-items:flex-end;gap:1rem;justify-content:space-between}
  .epv__controls{display:flex;gap:1rem;flex-wrap:wrap;align-items:center}
  .epv__controls label{font-size:.9rem;display:flex;flex-direction:column;gap:.4rem;color:var(--epv-muted)}
  .epv__controls select{min-width:13ch;padding:.5rem .6rem;border-radius:8px;border:1px solid #1f2a44;background:#0a1427;color:var(--epv-fg)}
  .epv__btn{padding:.55rem .8rem;border-radius:8px;border:1px solid #1f2a44;background:#0a1427;color:var(--epv-fg);cursor:pointer}
  .epv__btn:hover{border-color:var(--epv-accent)}
  .epv__toast{min-height:1.2rem;font-size:.85rem;color:#a5f3fc}
  .epv__pipeline{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:1rem;margin-top:1rem}
  @media(min-width:900px){.epv__pipeline{grid-template-columns:repeat(2,minmax(0,1fr))}}
  .epv__card{background:rgba(2,6,23,.55);border:1px solid #142038;border-radius:12px;overflow:hidden}
  .epv__card header{padding:.75rem 1rem;border-bottom:1px solid #142038;background:rgba(2,6,23,.66);font-weight:600}
  .epv__kv{display:grid;grid-template-columns:auto 1fr;gap:.4rem 1rem;padding: .75rem 1rem}
  .epv__kv b{font-weight:600;color:var(--epv-muted)}
  .epv__kv span{color:var(--epv-fg)}
  .epv__code{margin:0;padding:1rem;max-height:320px;overflow:auto;background:#0b1220}
  .epv__code code{white-space:pre-wrap;word-break:break-word;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:.88rem;line-height:1.35}
  .epv .hl {color:#a5f3fc}
</style>

<script>
(() => {
  const BASE_PATH = './html/'; // 如果你的 JSON 不在 html/，改这里
  const TASK_FILES = {
    generation: 'generation.json',
    completion: 'completion.json',
    translation: 'translation.json',
    interpretation_logic: 'interpretation_logic.json',
    interpretation_notation: 'interpretation_notation.json',
    correction_false: 'correction_false.json',
    correction_error: 'correction_error.json'
  };

  const DEFAULTS = {
    task: 'generation',
    lang: 'spdl', // 若不存在会回退
    model: 'llama4-maverick-instruct-basic'
  };

  const els = {
    task: document.getElementById('epv-task'),
    lang: document.getElementById('epv-lang'),
    model: document.getElementById('epv-model'),
    reload: document.getElementById('epv-reload'),
    toast: document.getElementById('epv-toast'),
    file: document.getElementById('epv-file'),
    inputdata: document.getElementById('epv-inputdata'),
    prompt: document.getElementById('epv-prompt'),
    modelinput: document.getElementById('epv-modelinput'),
    modeloutput: document.getElementById('epv-modeloutput'),
    evalresult: document.getElementById('epv-evalresult')
  };

  const state = {
    datasets: {},   // {task: jsonContent}
    task: DEFAULTS.task,
    lang: DEFAULTS.lang,
    model: DEFAULTS.model
  };

  // ---------- utils ----------
  // ----- helpers for structure-agnostic parsing -----
  function isModelRecord(v){
    return v && typeof v === 'object' && !Array.isArray(v) &&
      ('filename' in v || 'inputdata' in v || 'prompt' in v || 'modelinput' in v || 'modeloutput' in v || 'evalresult' in v);
  }
  function looksLikeLangMap(node){
    if (!node || typeof node !== 'object' || Array.isArray(node)) return false;
    for (const k of Object.keys(node)){
      const v = node[k];
      if (!v || typeof v !== 'object' || Array.isArray(v)) return false;
      const mk = Object.keys(v)[0];
      if (mk && isModelRecord(v[mk])) return true;
    }
    return false;
  }
  /** Accept any root; return the language layer: { lang : { model : record } } */
  function unwrapToLangMap(json){
    let node = json;
    let guard = 0;
    while (guard < 4 && node && typeof node === 'object' && !Array.isArray(node) && Object.keys(node).length === 1){
      const k = Object.keys(node)[0];
      const next = node[k];
      if (typeof next === 'object' && next) { node = next; guard++; } else break;
    }
    if (!looksLikeLangMap(node) && looksLikeLangMap(json)) return json;
    return node;
  }
  function prettyMaybeJson(v){
    if (typeof v === 'string') {
      try { return JSON.stringify(JSON.parse(v), null, 2); } catch { return v; }
    }
    if (v == null) return '—';
    try { return JSON.stringify(v, null, 2); } catch { return String(v); }
  }

  const toast = (msg) => { els.toast.textContent = msg || ''; };
  const safeString = (v) => (typeof v === 'string' ? v : JSON.stringify(v, null, 2));
  // const prettyMaybeJson = (text) => {
  //   if (typeof text !== 'string') return JSON.stringify(text, null, 2);
  //   try { return JSON.stringify(JSON.parse(text), null, 2); } catch { return text; }
  // };
  const fetchJson = async (url) => {
    const res = await fetch(url, { cache: 'no-store' });
    if (!res.ok) throw new Error('HTTP ' + res.status);
    return res.json();
  };

  // ---------- data loading ----------
  async function loadAll() {
    const entries = Object.entries(TASK_FILES);
    const ok = [], fail = [];
    const results = await Promise.allSettled(
      entries.map(([task, file]) => fetchJson(BASE_PATH + file))
    );
    const datasets = {};
    results.forEach((r, idx) => {
      const [task] = entries[idx];
      if (r.status === 'fulfilled' && r.value) {
        datasets[task] = unwrapToLangMap(r.value); // 只保留语言层
        ok.push(task);
      } else {
        fail.push(task);
      }
    });
    state.datasets = datasets;

    // 只展示加载成功的任务
    els.task.innerHTML = '';
    ok.forEach(t => {
      const opt = document.createElement('option');
      opt.value = t; opt.textContent = t;
      els.task.appendChild(opt);
    });
    if (!ok.length) throw new Error('No task JSON loaded. Please check file paths or deployment.');

    state.task = ok.includes(state.task) ? state.task : ok[0];
    els.task.value = state.task;

    if (fail.length) toast('Missing tasks: ' + fail.join(', '));
    else toast('');
  }

  // ---------- selectors population ----------
  function populateLangAndModel() {
    const langRoot = state.datasets[state.task] || {}; // 已是语言层
    const langs = Object.keys(langRoot);

    // language
    let lang = state.lang;
    if (!langRoot[lang]) {
      lang = langs[0] || '';
      if (state.lang && state.lang !== lang) toast('Language "' + state.lang + '" not available. Switched to "' + lang + '".');
      state.lang = lang;
    }
    els.lang.innerHTML = '';
    langs.forEach(l => {
      const opt = document.createElement('option');
      opt.value = l; opt.textContent = l;
      if (l === state.lang) opt.selected = true;
      els.lang.appendChild(opt);
    });

    // model
    const models = Object.keys(langRoot[state.lang] || {});
    let model = state.model;
    if (!models.includes(model)) {
      model = models[0] || '';
      if (state.model && state.model !== model) toast('Model "' + state.model + '" not under "' + state.lang + '". Switched to "' + model + '".');
      state.model = model;
    }
    els.model.innerHTML = '';
    models.forEach(m => {
      const opt = document.createElement('option');
      opt.value = m; opt.textContent = m;
      if (m === state.model) opt.selected = true;
      els.model.appendChild(opt);
    });

    if (langs.length) toast('Available languages: ' + langs.join(', '));
  }

  // ---------- rendering ----------
  function render() {
    const langRoot = state.datasets[state.task] || {};
    const record = (langRoot[state.lang] || {})[state.model] || {};

    // file: from record.filename (JSON model layer), not inputdata.file
    els.file.textContent = record.filename || '—';

    // Dataset Content: show entire inputdata (object/string)
    els.inputdata.textContent = prettyMaybeJson(record.inputdata ?? '—');

    // Others
    els.prompt.textContent      = prettyMaybeJson(record.prompt ?? '—');
    els.modelinput.textContent  = prettyMaybeJson(record.modelinput ?? '—');
    els.modeloutput.textContent = typeof record.modeloutput === 'string' ? record.modeloutput : prettyMaybeJson(record.modeloutput ?? '—');
    els.evalresult.textContent  = prettyMaybeJson(record.evalresult ?? '—');
  }

  // ---------- events ----------
  els.task.addEventListener('change', () => {
    state.task = els.task.value;
    toast('');
    populateLangAndModel();
    render();
  });
  els.lang.addEventListener('change', () => {
    state.lang = els.lang.value;
    toast('');
    populateLangAndModel(); // 语言变化后刷新模型列表
    render();
  });
  els.model.addEventListener('change', () => {
    state.model = els.model.value;
    toast('');
    render();
  });
  els.reload.addEventListener('click', async () => {
    toast('Reloading…');
    await loadAll();
    populateLangAndModel();
    render();
    toast('✅ Reloaded from JSON.');
  });

  // ---------- boot ----------
  (async function boot(){
    try {
      await loadAll();
      // 设置默认任务选择器（如果有有效数据）
      if (state.datasets[state.task]) {
        els.task.value = state.task;
      } else {
        const firstTask = Object.keys(state.datasets)[0];
        if (firstTask) els.task.value = state.task = firstTask;
      }
      populateLangAndModel();
      render();
      // 若默认语言/模型确实命中则提示为空；否则 toast 已在 populate 中提示
      if (!els.toast.textContent) toast('✅ Loaded: ' + state.task + ' / ' + state.lang + ' / ' + state.model);
      } catch(e){
        console.error(e);
        toast('Failed to load. Please check JSON paths or console.');
      }
  })();
})();
</script>
<!-- ========== /Eval Process Viewer ========== -->

<!-- ===== Demo Video (place before </body>) ===== -->
<section id="demo-video" class="demo-video" aria-labelledby="demo-video-title">
  <h2 id="demo-video-title"> Video: Automatic Validation for Generation Task of Seven Formal Languages (grok-3 LLM)</h2>

  <!-- Responsive 16:9 container -->
  <div class="video-box">
    <!-- Primary attempt: inline via <object> -->
    <object
      data="./html/generation_grok-3.mp4"
      type="video/mp4"
      width="100%" height="100%"
      aria-label="generation_grok-3 (inline)">
      <!-- Fallback 1: try <embed> -->
      <embed src="./html/generation_grok-3.mp4" type="video/mp4" width="100%" height="100%">
      <!-- Fallback 2: show a poster-like link (opens the MP4 in a new tab) -->
      <a class="video-fallback" href="./html/generation_grok-3.mp4" target="_blank" rel="noopener">
        ▶ Open video (MP4)
      </a>
    </object>
  </div>

  <!-- Always-visible final fallback / download -->
  <p class="video-note">
    Can’t play inline? <a href="./html/generation_grok-3.mp4" target="_blank" rel="noopener" style="color: white;">Open in a new tab</a>
    or <a href="./html/generation_grok-3.mp4" style="color: white;" download>Download the video</a>.
  </p>

  <noscript>
    <p><a href="./html/generation_grok-3.mp4" style="color: white;">Download the video</a></p>
  </noscript>
</section>

<style>
  .demo-video { margin: 2rem 0; }
  .demo-video h2 { margin: 0 0 .75rem; }
  /* Aspect ratio wrapper (16:9) */
  .video-box {
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    background: #000;
    border: 1px solid #142038;
    border-radius: 12px;
  }
  .video-box object,
  .video-box embed,
  .video-box iframe {
    position: absolute; inset: 0;
    width: 100%; height: 100%;
    border: 0; display: block;
    background: #000;
  }
  .video-fallback {
    position: absolute; inset: 0;
    display: flex; align-items: center; justify-content: center;
    color: #fff; text-decoration: none;
    background: linear-gradient(0deg, rgba(0,0,0,.65), rgba(0,0,0,.65));
    font-weight: 600;
    letter-spacing: .2px;
  }
  .video-fallback:hover { text-decoration: underline; }
  .video-note { font-size: .9rem; opacity: .85; margin-top: .5rem; }
  @media (prefers-reduced-motion: reduce) { .video-box { animation: none !important; } }
</style>

<footer class="footer">
  <p>© 2025 CrypFormBench • Reproducibility First.</p>
</footer>

</body>
</html>
